<!DOCTYPE html>
<html>

<head>
    <title>com.geekyeggo.sdpi.sdPlugin</title>
    <meta charset="utf-8" />
</head>

<body>
    <script>
        const colors = [{
            label: 'Primary Colors',
            children: [{
                label: 'Red',
                value: '#ff0000'
            }, {
                label: 'Green',
                value: '#00ff00'
            }, {
                label: 'Blue',
                value: '#0000ff'
            }]
        }, {
            label: 'Black',
            value: '#000000'
        }, {
            label: 'White',
            value: '#ffffff'
        }];

        function connectElgatoStreamDeckSocket(inPort, inPluginUUID, inRegisterEvent, inInfo) {
            console.log('Initializing plug-in.');
            let count = 0;
            const webSocket = new WebSocket(`ws://127.0.0.1:${inPort}`);

            // Handle messages from the Stream Deck.
            webSocket.onmessage = (e) => {
                const msg = JSON.parse(e.data);
                const { event, action, context } = msg;

                switch (event) {
                    case 'keyDown':
                        webSocket.send(
                            JSON.stringify({
                                event: 'setTitle',
                                context,
                                payload: {
                                    title: `${++count}`
                                }
                            })
                        );

                        break;

                    case 'sendToPlugin':
                        if (msg.payload?.event === 'getColors') {
                            webSocket.send(
                                JSON.stringify({
                                    action,
                                    event: 'sendToPropertyInspector',
                                    context,
                                    payload: {
                                        event: msg.payload.event,
                                        items: colors
                                    }
                                })
                            );
                        }

                        break;
                }
            };

            // Register the plugin when the connection opens.
            webSocket.onopen = () => {
                console.log('Registering plug-in...');
                webSocket.send(JSON.stringify({
                    'event': inRegisterEvent,
                    'uuid': inPluginUUID
                }));
            };
        };
    </script>
</body>

</html>